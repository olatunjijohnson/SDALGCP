% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dm_functions.R
\name{SDALGCPMCML}
\alias{SDALGCPMCML}
\title{Parameter Estimation for SDA-LGCP Using Monte Carlo Maximum Likelihood}
\usage{
SDALGCPMCML(
  formula,
  data,
  my_shp,
  delta,
  phi = NULL,
  method = 1,
  pop_shp = NULL,
  weighted = FALSE,
  par0 = NULL,
  control.mcmc = NULL,
  plot = FALSE,
  plot_profile = TRUE,
  rho = NULL,
  giveup = NULL,
  messages = FALSE
)
}
\arguments{
\item{formula}{A \code{formula} describing the fixed effects structure of the model (e.g., \code{cases ~ covariate1 + offset(log(pop))}).}

\item{data}{A data frame containing variables used in the model.}

\item{my_shp}{An `sf`, `SpatialPolygons`, or `SpatialPolygonsDataFrame` object defining the study region polygons.}

\item{delta}{A numeric value controlling the spatial resolution for polygon sampling (e.g., spacing between points).}

\item{phi}{Optional numeric vector of spatial range (scale) parameters to evaluate during optimization. If \code{NULL}, defaults to a sequence based on spatial extent.}

\item{method}{Integer indicating sampling method: 1 = Simple Sequential Inhibition (default), 2 = Uniform random, 3 = Regular grid.}

\item{pop_shp}{Optional population raster (e.g., from `terra` or `raster`) used for population-weighted point sampling.}

\item{weighted}{Logical; if \code{TRUE}, candidate point sampling is weighted by \code{pop_shp}. Default is \code{FALSE}.}

\item{par0}{Optional numeric vector of initial values: \code{c(beta coefficients, sigma^2, phi)}.}

\item{control.mcmc}{A list of MCMC settings created using \code{\link{controlmcmcSDA}}.}

\item{plot}{Logical; if \code{TRUE}, sampled points are visualized. Default is \code{FALSE}.}

\item{plot_profile}{Logical; if \code{TRUE}, profile likelihood for \code{phi} is plotted. Default is \code{TRUE}.}

\item{rho}{Packing density for SSI sampling (method 1). Default is \code{NULL}.}

\item{giveup}{Maximum number of failed point insertions before SSI stops. Default is \code{NULL}.}

\item{messages}{Logical; if \code{TRUE}, estimation progress is printed. Default is \code{FALSE}.}
}
\value{
An object of class \code{"SDALGCP"} with components:
\describe{
  \item{\code{D}}{Design matrix for fixed effects.}
  \item{\code{y}}{Response variable (counts).}
  \item{\code{m}}{Offset vector (e.g., population).}
  \item{\code{beta_opt}}{Estimated fixed effect coefficients.}
  \item{\code{sigma2_opt}}{Estimated process variance.}
  \item{\code{phi_opt}}{Estimated spatial scale parameter.}
  \item{\code{cov}}{Covariance matrix of estimated parameters.}
  \item{\code{Sigma_mat_opt}}{Covariance matrix for optimal parameters.}
  \item{\code{llike_val_opt}}{Maximum log-likelihood value.}
  \item{\code{mu}}{Fitted linear predictor values.}
  \item{\code{all_para}}{Parameter estimates across all \code{phi} values.}
  \item{\code{all_cov}}{Covariance matrices across all \code{phi} values.}
  \item{\code{par0}}{Initial values used in optimization.}
  \item{\code{control.mcmc}}{MCMC control settings used.}
  \item{\code{call}}{The original function call.}
}
}
\description{
Fits a spatially discrete approximation to a log-Gaussian Cox process (SDA-LGCP) model for areal count data
via Monte Carlo Maximum Likelihood (MCML). The function supports both `sp` and `sf` formats and includes spatial point sampling,
correlation matrix precomputation, and likelihood optimization.
}
\details{
This function implements the spatially discrete approximation to LGCP models as proposed in Christensen (2004) and Giorgi & Diggle (2017),
estimating the latent Gaussian process and fixed effects using MCML. The approach involves:
\enumerate{
  \item Generating candidate locations within each polygon.
  \item Precomputing correlation matrices for candidate points and a grid of \code{phi} values.
  \item Performing likelihood-based parameter estimation using Langevin-Hastings MCMC.
}
}
\examples{
data(PBCshp)
df <- as.data.frame(PBCshp@data)
FORM <- X ~ propmale + Income + Employment + Education + Barriers + Crime +
           Environment + offset(log(pop))
phi_vals <- seq(500, 1700, length.out = 5)
glm_mod <- glm(FORM, family = poisson, data = df)
par0 <- c(coef(glm_mod), mean(residuals(glm_mod)^2), median(phi_vals))
control.mcmc <- controlmcmcSDA(n.sim = 10000, burnin = 2000, thin = 8,
                               h = 1.65/(545^(1/6)), c1.h = 0.01, c2.h = 1e-4)


}
\references{
Giorgi, E., & Diggle, P. J. (2017). PrevMap: An R package for prevalence mapping. *Journal of Statistical Software*, 78(8), 1–29. \doi{10.18637/jss.v078.i08} \cr
Christensen, O. F. (2004). Monte Carlo maximum likelihood in model-based geostatistics. *Journal of Computational and Graphical Statistics*, 13(3), 702–718. \doi{10.1198/106186004X2525}
}
\seealso{
\code{\link{controlmcmcSDA}}, \code{\link{SDALGCPpolygonpoints}}, \code{\link{Laplace.sampling}}, \code{\link{summary.SDALGCP}}
}
\author{
Olatunji O. Johnson \email{o.johnson@lancaster.ac.uk} \cr
Emanuele Giorgi \email{e.giorgi@lancaster.ac.uk} \cr
Peter J. Diggle \email{p.diggle@lancaster.ac.uk}
}
