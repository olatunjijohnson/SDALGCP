% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dm_functions.R
\name{Aggregated_poisson_log_MCML}
\alias{Aggregated_poisson_log_MCML}
\title{Aggregated Poisson Log MCML Estimation}
\usage{
Aggregated_poisson_log_MCML(
  y,
  D,
  m,
  corr,
  par0,
  control.mcmc,
  S.sim,
  Denominator,
  messages = FALSE
)
}
\arguments{
\item{y}{A numeric vector of observed counts.}

\item{D}{A design matrix for the fixed effects (dimension: n × p).}

\item{m}{A numeric vector of offset values (e.g., population at risk).}

\item{corr}{The spatial correlation matrix (e.g., from \code{\link{precomputeCorrMatrix}}).}

\item{par0}{Initial parameter vector: \code{c(beta, sigma2, phi)} where beta is of length \code{ncol(D)}.}

\item{control.mcmc}{Output from \code{\link{controlmcmcSDA}} specifying the MCMC control options (not used in this function but passed for compatibility).}

\item{S.sim}{A matrix of posterior samples of the latent spatial field (dimension: nsim × n).}

\item{Denominator}{A numeric value representing the importance sampling denominator (normalizing constant).}

\item{messages}{Logical; if \code{TRUE}, progress messages are printed during optimization. Default is \code{FALSE}.}
}
\value{
A list with the following elements:
\describe{
  \item{estimate}{Named vector of MCML estimates for the fixed effects and log-variance \code{log(sigma^2)}.}
  \item{covariance}{Covariance matrix of the parameter estimates.}
  \item{value}{The log-likelihood at the optimum.}
  \item{S}{The posterior samples of the latent field used in the optimization.}
}
}
\description{
Performs Monte Carlo Maximum Likelihood (MCML) estimation for the spatial Poisson log-linear model with aggregated data using a given correlation matrix.
}
\details{
The function uses Laplace importance sampling and numerical optimization via \code{nlminb} to maximize the MCML objective function.
The spatial field \code{S.sim} should be drawn from the Laplace approximation to the posterior of the latent field under initial parameters.

The correlation matrix is treated as fixed (conditioned on \code{phi}), and only the fixed effects and variance parameters are estimated.
}
\references{
Giorgi, E., & Diggle, P. J. (2017). PrevMap: an R package for prevalence mapping. \emph{Journal of Statistical Software}, 78(8), 1–29. \doi{10.18637/jss.v078.i08}

Christensen, O. F. (2004). Monte Carlo maximum likelihood in model-based geostatistics. \emph{Journal of Computational and Graphical Statistics}, 13(3), 702–718.
}
\seealso{
\code{\link{precomputeCorrMatrix}}, \code{\link{controlmcmcSDA}}, \code{\link{Laplace.sampling}}
}
\keyword{MCML}
\keyword{Poisson}
\keyword{geostatistics}
\keyword{internal}
\keyword{likelihood}
\keyword{model}
\keyword{optimization}
\keyword{spatial}
